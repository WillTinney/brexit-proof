<br><br>

<div class="container-box profile-cards">
  <div class="row">
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="alt-card black-links <%= 'orange-border' unless @user.details_completed? %>">
        <% unless @user.details_completed? %>
          <i class="fa fa-exclamation-circle warning-circle" aria-hidden="true"></i>
        <% end %>
        <h4><%= link_to "My Details", "#", id: "details-card" %></h4>
        <hr>
        <div class="card-content card-overflow">
          <p><strong><%= @user.try(:name_surname) %></strong></p>
          <p><%= @user.citizenship ? @user.citizenship + " Citizen" : "Please enter your citizenship" %></p>
          <p>Date of Birth: <%= @user.try(:date_of_birth) %></p>
          <p>Email: <%= @user.try(:email) %></p>
          <p>Phone Number: <%= @user.try(:phone_number) %></p>
          <p>Address: <%= @user.try(:address_line_1) + ", " + @user.try(:address_line_2) %></p>
          <p><%= @user.try(:town) + ", " + @user.try(:postcode) + (", " + @user.try(:country) if @user.country) %></p>
          <% unless @user.details_completed? %>
            <i class="fa fa-exclamation-triangle" aria-hidden="true"> Details incomplete</i>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="alt-card black-links <%= 'orange-border' unless @user.partner.details_completed? %>">
        <% if @user.assignees.where('relationship = ?', 'Partner') %>
          <% @user.assignees.where('relationship = ?', 'Partner').each do |partner| %>
            <% unless partner.details_completed? %>
              <i class="fa fa-exclamation-circle warning-circle" aria-hidden="true"></i>
            <% end %>
            <h4><%= link_to "My Partner", user_assignee_path(@user, partner) , id: "partner-card" %></h4>
            <hr>
            <div class="card-content card-overflow">
              <p><strong><%= link_to partner.name_surname, user_assignee_path(@user, partner) %></strong></p>
              <p><%= partner.phone_number %></p>
              <br>
              <p><%= @user.try(:address_line_1) + ", " + @user.try(:address_line_2) %></p>
              <p><%= @user.try(:town) + ", " + @user.try(:postcode) %></p>
            </div>
          <% end %>
        <% else %>
          <h4><%= link_to "My Partner", "#" , id: "partner-card" %></h4>
          <hr>
          <p>You have not assigned a partner.</p>
        <% end %>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="alt-card black-links">
        <h4><%= link_to "My Children", "#", id: "children-card" %></h4>
        <hr>
        <div class="card-content card-overflow">
          <% @user.assignees.where('relationship = ?', 'Child').each do |child| %>
            <div class="<%= 'small-orange-border' unless child.details_completed? %>">
              <% unless child.details_completed? %>
                <i class="fa fa-exclamation-circle warning-circle" aria-hidden="true"></i>
              <% end %>
              <p><strong><%= link_to child.try(:name_surname), user_assignee_path(@user, child) %></strong></p>
              <p><%= child.try(:phone_number) %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="alt-card black-links">
        <h4><%= link_to "My Guardians", "#", id: "guardian-card" %></h4>
        <hr>
        <div class="card-content card-overflow">
          <% @user.guardians.each do |guardian| %>
            <div class="<%= 'small-orange-border' unless guardian.details_completed? %>">
              <% unless guardian.details_completed? %>
                <i class="fa fa-exclamation-circle warning-circle" aria-hidden="true"></i>
              <% end %>
              <p><strong><%= link_to guardian.name_surname, user_assignee_path(@user, guardian) %></strong></p>
              <p><%= guardian.try(:phone_number) %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="alt-card black-links <%= 'orange-border' if @user.proofs.all == [] %>">
        <% if @user.proofs.all == [] %>
          <i class="fa fa-exclamation-circle warning-circle" aria-hidden="true"></i>
        <% end %>
        <h4><%= link_to "Proof of Residency", "#", id: "proof-card" %></h4>
        <hr>
        <div class="card-content card-overflow">
          <% @user.proofs.each do |proof| %>
            <p>- <%= proof.title %></strong></p>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="alt-card black-links">
        <h4><%= link_to "Notes", "#", id: "notes-card" %></h4>
        <hr>
        <div class="card-content card-overflow">
          <% @user.notes.each do |note| %>
            <p><%= note.title %> - <strong><%= Assignee.find(note.assignee_id).first_name %></strong></p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for(:after_js) do %>
  <script>
    // Clicking on platform icons on profile tab loads tab content
    $('#details-card').click(function(e){
      e.preventDefault();
      $('.sidebar-tabs').children().removeClass('active');
      $('#personal-details-sidebar-tab').addClass('active')
      $.ajax({
          type: "GET",
          url: <%= @user.id %> + "/edit",
          data: { },
          success: function(data){
              $('#tab-content').empty().html(data);
          }
      });
    });
    // $('#partner-card').click(function(e){
    //   e.preventDefault();
    //   $('.sidebar-tabs').children().removeClass('active');
    //   $('#partner-sidebar-tab').addClass('active')
    //   $.ajax({
    //       type: "GET",
    //       url: <%= @user.id %> + "/assignees/" + <%= @user.partner.id if @user.partner %>,
    //       data: { },
    //       success: function(data){
    //           $('#tab-content').empty().html(data);
    //       }
    //   });
    // });
    $('#children-card').click(function(e){
      e.preventDefault();
      $('.sidebar-tabs').children().removeClass('active');
      $('#children-sidebar-tab').addClass('active')
      $.ajax({
          type: "GET",
          url: <%= @user.id %> + "/children",
          data: { },
          success: function(data){
              $('#tab-content').empty().html(data);
          }
      });
    });
    $('#guardian-card').click(function(e){
      e.preventDefault();
      $('.sidebar-tabs').children().removeClass('active');
      $('#guardian-sidebar-tab').addClass('active')
      $.ajax({
          type: "GET",
          url: <%= @user.id %> + "/guardians",
          data: { },
          success: function(data){
              $('#tab-content').empty().html(data);
          }
      });
    });
    $('#proof-card').click(function(e){
      e.preventDefault();
      $('.sidebar-tabs').children().removeClass('active');
      $('#proof-of-residency-sidebar-tab').addClass('active')
      $.ajax({
          type: "GET",
          url: <%= @user.id %> + "/proofs",
          data: { },
          success: function(data){
              $('#tab-content').empty().html(data);
          }
      });
    });
    $('#notes-card').click(function(e){
      e.preventDefault();
      $('.sidebar-tabs').children().removeClass('active');
      $('#notes-sidebar-tab').addClass('active')
      $.ajax({
          type: "GET",
          url: <%= @user.id %> + "/notes",
          data: { },
          success: function(data){
              $('#tab-content').empty().html(data);
          }
      });
    });
    // Clicking on digital assets icon loads tab content
    $('#digital-icon').click(function(e){
      e.preventDefault();
      $('.sidebar-tabs').children().removeClass('active');
      $('#digital-assets-sidebar-tab').addClass('active')
      $.ajax({
          type: "GET",
          url: <%= @user.id %> + "/digital",
          data: { },
          success: function(data){
              $('#tab-content').empty().html(data);
          }
      });
    });
  </script>
<% end %>
